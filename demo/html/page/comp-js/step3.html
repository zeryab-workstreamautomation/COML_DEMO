<html>

<head>
    <script>
        this.import('demo/element/CoCode');
        this.import('demo/element/CoError');
        this.import('demo/element/CoMarkdown');
        this.import('coml/element/Pages');
        this.import({name:'element/nav.html',type:'page'},'co-nav');

    </script>
</head>

<body>
  <co-nav></co-nav>
  
<co-markdown>

Lets fetch live temperature changes from a service. 

The API call is [https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41](https://api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41)

The result looks like:
</co-markdown>
<co-code src="comp-js/temperature.json" mode="javascript" class="u-code-5"></co-code>
<co-markdown>
Below is the updated `&lt;co-weather&gt;` component. Compile the code below then run it.

</co-markdown>

<co-code id="step3a" src="comp-js/step3.js" mode="javascript" class="u-code-20"></co-code>

<div class="u-coderunner" onclick="executejs(this,'step3a','step3aerror')">Compile</div>

<co-error id="step3aerror"></co-error>


<co-markdown>

Here is a simple page that uses the component.
   
 </co-markdown>
   
   
 <co-code id="sstep3b" class="u-code-small">
   <script>
     this.import('WeatherFactory');
   </script>
 
   <co-weather lat="52.52" long="13.41"></co-weather>
 
 
 </co-code>
 
 <div class="u-coderunner" onclick="runcode(this,'sstep3b','sstep3brunner')">Run Code</div>
 
 <pages id="sstep3brunner" class="u-codetarget" style="max-height: fit-content;"></pages>

<co-markdown>

## Asyncronous data fetches

We often need to read data asyncronously from a server or web service. The above example shows the basic pattern for doing this.

1. In your `onRender` check if the data exists, if not issue an asyncronous call.
2. When the asnyc call (usually a [Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)) resolves, store the data and
3. ... call [this.invalidate()](@coml-fns/invalidate.html) to make the weather component redraw itself.

### The invalidate() call.

The invalidate method marks part of the dom tree for rebuilding. It will remove the original element generated by your `onRender` method, and then call onRender again.

This is the usual way that state changes in a Component are updated to the browser.

## Reading attributes

Note that [attr()](@coml-fns/attr.html) call used to supply the coordinates to the web service. This is how a component can read its element's attributes.

The attributes can contain embedded Javascript expressions, using the [String template](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals) format.


</co-markdown>

<co-nav show-title="false"></co-nav>

<div class="u-page-spacer"></div>


</body>